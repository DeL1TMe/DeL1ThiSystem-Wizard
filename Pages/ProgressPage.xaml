<Page x:Class="DeL1ThiSystem.ConfigurationWizard.Pages.ProgressPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="Transparent">

    <Page.Resources>
        <Style x:Key="ProgressBlinkText" TargetType="TextBlock" BasedOn="{StaticResource Txt.Body14}">
            <Setter Property="Foreground" Value="{DynamicResource Brush.TextSecondary}"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                    <DataTrigger.EnterActions>
                        <BeginStoryboard x:Name="BlinkStoryboard">
                            <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                 From="1" To="0.35" Duration="0:0:1.1"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.EnterActions>
                    <DataTrigger.ExitActions>
                        <StopStoryboard BeginStoryboardName="BlinkStoryboard"/>
                    </DataTrigger.ExitActions>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ProgressRebootButton" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#2A3345"/>
            <Setter Property="BorderBrush" Value="#3A445A"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border CornerRadius="6"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="True">
                                <Setter Property="Background" Value="{DynamicResource Brush.Accent}"/>
                                <Setter Property="BorderBrush" Value="Transparent"/>
                                <Setter Property="BorderThickness" Value="0"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsEnabled" Value="True"/>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter Property="Background" Value="#2D6FDC"/>
                                <Setter Property="BorderBrush" Value="#2D6FDC"/>
                            </MultiTrigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsEnabled" Value="True"/>
                                    <Condition Property="IsPressed" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter Property="Background" Value="#1C56B8"/>
                                <Setter Property="BorderBrush" Value="#1C56B8"/>
                            </MultiTrigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        
        <Grid Grid.Row="0" VerticalAlignment="Center">
            
            <StackPanel HorizontalAlignment="Center" Width="630">
                <TextBlock Style="{StaticResource Txt.H1}"
                           Text="{Binding HeaderText}" TextAlignment="Center" Margin="0,0,0,8"/>

                <TextBlock Style="{StaticResource ProgressBlinkText}"
                           Text="{Binding CurrentStepText}" TextAlignment="Center" Margin="0,0,0,18"/>

                
                
                <Grid Margin="0,0,0,10" Width="630" Height="16" SnapsToDevicePixels="True" UseLayoutRounding="True"
                      Visibility="{Binding ProgressVisibility}">
                    

                    
                    <Rectangle RadiusX="6" RadiusY="6" Stroke="#6B7C93" StrokeThickness="2" Fill="Transparent" SnapsToDevicePixels="True"/>

                    
                    <Grid Margin="1" SnapsToDevicePixels="True">
                        <Grid.Clip>
                            <RectangleGeometry Rect="0,0,628,14" RadiusX="6" RadiusY="6"/>
                        </Grid.Clip>

                        <Rectangle RadiusX="6" RadiusY="6" Fill="#D9D9D9"/>
                        <Rectangle RadiusX="6" RadiusY="6" Fill="#0078D4"
                                   HorizontalAlignment="Left" Width="{Binding ProgressWidth}"/>
                    </Grid>
                </Grid>

                <TextBlock Style="{StaticResource Txt.Body14}"
                           Text="{Binding PercentText}" TextAlignment="Center" Opacity="0.9"
                           Visibility="{Binding ProgressVisibility}"/>
            </StackPanel>
        </Grid>

        
        <Border Grid.Row="1" Background="{DynamicResource Brush.FooterBar}"
                CornerRadius="0,0,16,16" Padding="18,12"
                Visibility="{Binding FooterVisibility}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Style="{StaticResource FooterNoteText}"
                           Text="{Binding FooterText}" TextWrapping="Wrap" VerticalAlignment="Center"/>

                <Button Grid.Column="1" Content="Понятно" Width="130" Height="34" Margin="8,0,0,0"
                        Style="{StaticResource ConceptPrimaryButton}"
                        Visibility="{Binding FooterDismissVisible}"
                        Click="HideFooter_Click"/>

                <Button Grid.Column="1" Content="Перезагрузить" Width="130" Height="34" Margin="0,0,0,0"
                        Style="{StaticResource ProgressRebootButton}"
                        Visibility="{Binding RebootVisible}"
                        IsEnabled="{Binding RebootEnabled}"
                        Click="Reboot_Click"/>
            </Grid>
        </Border>
    </Grid>
</Page>

