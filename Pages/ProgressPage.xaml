<Page x:Class="DeL1ThiSystem.ConfigurationWizard.Pages.ProgressPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="Transparent">

    <Page.Resources>
        <Style x:Key="ProgressBlinkText" TargetType="TextBlock" BasedOn="{StaticResource Txt.Body14}">
            <Setter Property="Foreground" Value="{DynamicResource Brush.TextSecondary}"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                    <DataTrigger.EnterActions>
                        <BeginStoryboard x:Name="BlinkStoryboard">
                            <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                 From="1" To="0.35" Duration="0:0:1.1"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.EnterActions>
                    <DataTrigger.ExitActions>
                        <StopStoryboard BeginStoryboardName="BlinkStoryboard"/>
                    </DataTrigger.ExitActions>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ProgressRebootButton" TargetType="Button">
            <Setter Property="Foreground" Value="#E6FFFFFF"/>
            <Setter Property="Background" Value="#2A3345"/>
            <Setter Property="BorderBrush" Value="{DynamicResource Brush.RebootButtonBorder}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Height" Value="34"/>
            <Setter Property="MinHeight" Value="34"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="UseLayoutRounding" Value="True"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border CornerRadius="6"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                SnapsToDevicePixels="True">
                            <ContentPresenter x:Name="cp"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="True">
                                <Setter Property="Background" Value="{DynamicResource Brush.RebootButtonBg}"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource Brush.RebootButtonBorderActive}"/>
                                <Setter Property="BorderThickness" Value="0"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsEnabled" Value="True"/>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter Property="Background" Value="{DynamicResource Brush.RebootButtonBgHover}"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource Brush.RebootButtonBorderActive}"/>
                                <Setter Property="BorderThickness" Value="0"/>
                            </MultiTrigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsEnabled" Value="True"/>
                                    <Condition Property="IsPressed" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter Property="Background" Value="{DynamicResource Brush.RebootButtonBgPressed}"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource Brush.RebootButtonBorderActive}"/>
                                <Setter Property="BorderThickness" Value="0"/>
                            </MultiTrigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="{DynamicResource Brush.RebootButtonBgDisabled}"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource Brush.RebootButtonBorder}"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Foreground" Value="{DynamicResource Brush.RebootButtonTextDisabled}"/>
                                <Setter TargetName="cp" Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        
        <Grid Grid.Row="0" VerticalAlignment="Center">
            
            <StackPanel HorizontalAlignment="Center" Width="630">
                <TextBlock x:Name="HeaderTextBlock" Style="{StaticResource Txt.H1}"
                           Text="{Binding HeaderText}" TextAlignment="Center" Margin="0,0,0,8"/>

                <TextBlock Style="{StaticResource ProgressBlinkText}"
                           Text="{Binding CurrentStepText}" TextAlignment="Center" Margin="0,0,0,18"/>

                
                
                <Grid Margin="0,0,0,10" Width="630" Height="16" SnapsToDevicePixels="True" UseLayoutRounding="True"
                      Visibility="{Binding ProgressVisibility}">
                    <Border Width="630" Height="16"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            CornerRadius="6"
                            Background="{DynamicResource Brush.PopupBorder}"
                            ClipToBounds="True"
                            SnapsToDevicePixels="True"
                            UseLayoutRounding="True">
                        <Rectangle RadiusX="6" RadiusY="6"
                                   Fill="#0078D4"
                                   HorizontalAlignment="Left"
                                   Width="{Binding ProgressWidth}"
                                   SnapsToDevicePixels="True"
                                   UseLayoutRounding="True"/>
                    </Border>
                </Grid>

                <TextBlock Style="{StaticResource Txt.Body14}"
                           Text="{Binding PercentText}" TextAlignment="Center" Opacity="0.9"
                           Visibility="{Binding ProgressVisibility}"/>
            </StackPanel>
        </Grid>

        
        <Border Grid.Row="1" Background="{DynamicResource Brush.FooterBar}"
                CornerRadius="0,0,16,16" Padding="18,12"
                Visibility="{Binding FooterVisibility}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Style="{StaticResource FooterNoteText}"
                           Text="{Binding FooterText}" TextWrapping="Wrap" VerticalAlignment="Center"/>

                <Button Grid.Column="1" Content="Понятно" Width="130" Height="34" Margin="8,0,0,0"
                        Style="{StaticResource ConceptPrimaryButton}"
                        Visibility="{Binding FooterDismissVisible}"
                        Click="HideFooter_Click"/>

                <Button Grid.Column="1" Content="Перезагрузить" Width="130" Height="34" Margin="0,0,0,0"
                        Style="{StaticResource ProgressRebootButton}"
                        Visibility="{Binding RebootVisible}"
                        IsEnabled="{Binding RebootEnabled}"
                        Click="Reboot_Click"/>
            </Grid>
        </Border>
    </Grid>
</Page>

